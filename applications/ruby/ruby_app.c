#include <stdio.h>
#include <stdlib.h>
#include "mrubyc.h"

#define MEMORY_SIZE (1024*30)
static uint8_t memory_pool[MEMORY_SIZE];

#define TAG "Ruby"
#ifdef __cplusplus
extern const uint8_t ruby_test[];
#endif
const uint8_t ruby_test[] = {
0x52,0x49,0x54,0x45,0x30,0x32,0x30,0x30,0x00,0x00,0x00,0x6a,0x4d,0x41,0x54,0x5a,
0x30,0x30,0x30,0x30,0x49,0x52,0x45,0x50,0x00,0x00,0x00,0x4e,0x30,0x33,0x30,0x30,
0x00,0x00,0x00,0x42,0x00,0x01,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x0c,0x14,0x01,
0x51,0x02,0x00,0x2f,0x01,0x00,0x01,0x39,0x01,0x6b,0x00,0x01,0x00,0x00,0x19,0x48,
0x65,0x6c,0x6c,0x6f,0x20,0x66,0x72,0x6f,0x6d,0x20,0x52,0x75,0x62,0x79,0x2c,0x20,
0x46,0x6c,0x69,0x70,0x70,0x65,0x72,0x21,0x00,0x00,0x01,0x00,0x04,0x70,0x75,0x74,
0x73,0x00,0x45,0x4e,0x44,0x00,0x00,0x00,0x00,0x08,
};

int32_t ruby_app(void* p)
{
  UNUSED(p);
  FURI_LOG_I(TAG, "Starting Ruby!!!");
  mrbc_init(memory_pool, MEMORY_SIZE);
  
  if( mrbc_create_task(ruby_test, 0) != NULL ){
    FURI_LOG_I(TAG, "Running Ruby!!!");
    mrbc_run();
  }
  else {
    FURI_LOG_I(TAG, "Failed to run Ruby :(");
  }

  FURI_LOG_I(TAG, "Ending Ruby!!!");
  return 0;
}
